name: CI Pipeline - Node.js + Snyk + Container Scan

on:
push:
branches: [ "main" ]
pull_request:

jobs:
build-test-scan:
runs-on: ubuntu-latest

```
steps:
  # 1️⃣ Checkout repository
  - name: Checkout code
    uses: actions/checkout@v4

  # 2️⃣ Set up Node.js
  - name: Set up Node.js
    uses: actions/setup-node@v4
    with:
      node-version: 18

  # 3️⃣ Install dependencies
  - name: Install dependencies
    run: npm install

  # 4️⃣ Run app/unit tests (without Snyk)
  - name: Run tests
    run: npm test

  # 5️⃣ Snyk test (checks for vulnerabilities)
  - name: Snyk Test
    uses: snyk/actions/node@master
    env:
      SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
    with:
      command: test

  # 6️⃣ Snyk monitor (uploads snapshot to Snyk dashboard)
  - name: Snyk Monitor
    uses: snyk/actions/node@master
    env:
      SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
    with:
      command: monitor

  # 7️⃣ Build Docker image
  - name: Build Docker image
    run: docker build -t nodejs-interview:${{ github.sha }} .

  # 8️⃣ Snyk test (Docker container scan)
  - name: Snyk Container Test
    uses: snyk/actions/docker@master
    env:
      SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
    with:
      image: nodejs-interview:${{ github.sha }}
      command: test

  # 9️⃣ Snyk monitor (Docker container)
  - name: Snyk Container Monitor
    uses: snyk/actions/docker@master
    env:
      SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
    with:
     
```
